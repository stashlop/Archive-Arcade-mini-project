<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe - Arcade and Archives</title>
    <style>
        body { margin: 0; font-family: sans-serif; color: white; }
        .spline-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .main-header, .hero-section { position: relative; z-index: 1; }
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; }
        .logo-link { display: flex; align-items: center; text-decoration: none; color: inherit; }
        .logo-text { font-size: 1.5rem; font-weight: bold; }
        .main-nav a { margin-left: 1.5rem; text-decoration: none; color: inherit; font-weight:600; }
        .hero-section { display: flex; justify-content: center; align-items: center; min-height: 70vh; }
        .hero-content { text-align: center; max-width: 980px; padding: 1rem; }
        .hero-text h1 { font-size: 3rem; margin-bottom: 1rem; }
        .hero-text p { font-size: 1.2rem; margin-bottom: 2rem; color: #e6e6e6; }
        .hero-btn { padding: 1rem 2rem; margin: 0 0.5rem; text-decoration: none; color: white; border: 1px solid rgba(255,255,255,0.25); border-radius: 5px; background: rgba(0,0,0,0.25); }

        /* Availability & tags */
        .card { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; padding: 1rem; margin-top: 1rem; text-align:left; }
        .row { display:flex; gap: .6rem; align-items: center; flex-wrap: wrap; justify-content:center; }
        .badge { display:inline-block; padding:.25rem .5rem; border-radius:999px; border:1px solid rgba(255,255,255,0.25); margin-left:.4rem; font-weight:600; }
        .ok { background: rgba(34,197,94,.25); border-color: rgba(34,197,94,.5); }
        .members { background: rgba(168,85,247,.25); border-color: rgba(168,85,247,.5); }
        .sold { background: rgba(239,68,68,.25); border-color: rgba(239,68,68,.5); }
        .small { opacity:.9; font-size: .95rem; }
        .input { background: rgba(0,0,0,.3); color:white; border:1px solid rgba(255,255,255,.25); border-radius:8px; padding:.5rem .6rem; }
        .btn { background:#3b82f6; color:#fff; border:none; border-radius:8px; padding:.55rem .8rem; cursor:pointer; }
    </style>
</head>
<body class="antialiased">

    <div class="spline-background">
        <iframe src="https://my.spline.design/updomi-5tiNZT76iShGB0qrIfkiKfOw/" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <header class="main-header">
        <a href="{{ url_for('home') }}" class="logo-link">
            <span class="logo-text">Arcade and Archives</span>
        </a>
        <nav class="main-nav">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('books') }}">Books</a>
            <a href="{{ url_for('video_games') }}">Video Games</a>
            <a href="{{ url_for('cafe') }}">Cafe</a>
            <a href="{{ url_for('history_page') }}">History</a>
        </nav>
    </header>

    <main class="hero-section">
        <div class="hero-content">
            <div class="hero-text">
                <h1>Cafe & Lounge</h1>
                <p>Recharge with seasonal brews. Members can book play sessions and host esports events in our lounge.</p>
            </div>
            <div class="card" aria-live="polite">
                <h3 style="margin-top:0">Check Availability</h3>
                <p class="small">Saturdays are reserved for members-only esports events. Sundays are fully booked. Other days are open to all.</p>
                <div class="row" style="margin:.6rem 0 0 0;">
                    <label for="when">Date:</label>
                    <input id="when" class="input" type="date" />
                    <button class="btn" onclick="checkCafe()">Check</button>
                </div>
                <div id="status" class="small" style="margin-top:.75rem"></div>
            </div>
            <div style="margin-top:1rem">
                <a class="hero-btn" href="{{ url_for('home') }}">Back Home</a>
            </div>
        </div>
    </main>

    <script>
        const logoLink = document.querySelector('.logo-link');
        const logoVideo = logoLink ? logoLink.querySelector('.logo-video') : null;
        if (logoLink && logoVideo) {
            logoLink.addEventListener('mouseenter', () => logoVideo.play());
            logoLink.addEventListener('mouseleave', () => { logoVideo.currentTime = 0; });
        }

        // Availability checker
        function fmt(d){
            const z = n => n.toString().padStart(2,'0');
            return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`;
        }
        function initDate(){
            const input = document.getElementById('when');
            if (input && !input.value) input.value = fmt(new Date());
        }
        async function checkCafe(){
            const input = document.getElementById('when');
            const out = document.getElementById('status');
            if (!input || !input.value) { out.textContent = 'Select a date first.'; return; }
            out.textContent = 'Checking...';
            try{
                const r = await fetch(`/api/cafe/availability?date=${encodeURIComponent(input.value)}`);
                const d = await r.json();
                if (!r.ok){ out.textContent = d.error || 'Error'; return; }
                let html = '';
                if (d.status === 'available') {
                    html = `‚úÖ Available <span class="badge ok">All welcome</span>`;
                } else if (d.status === 'members_only') {
                    html = `üïπÔ∏è Members-only on this day <span class="badge members">Esports events</span>`;
                } else if (d.status === 'sold_out') {
                    html = `‚õî Fully booked <span class="badge sold">Sold out</span>`;
                } else {
                    html = d.note || 'Unknown status';
                }
                out.innerHTML = html;
            }catch(e){
                out.textContent = 'Failed to check availability.';
            }
        }
        initDate();
    </script>
</body>
</html>